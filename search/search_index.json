{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":"<p>\ubaa9\ucc28 * qemu</p>"},{"location":"qemu/","title":"\uc774\ub860","text":"<p>\u2705 \ucd5c\uc885 \uc815\ub9ac</p> <p>\u2714\ufe0f \ubaa9\ud45c: Bare-metal\uc5d0\uc11c \ud558\ub4dc\uc6e8\uc5b4 \uc81c\uc5b4 \u2714\ufe0f \ud14c\uc2a4\ud2b8 \ud658\uacbd: QEMU ARM64 Virt Machine (LED \ub300\uc2e0 UART \ucd9c\ub825) \u2714\ufe0f \ubc29\ubc95: Bare-metal \u2192 UART \u2192 Timer \u2192 MMU \u2192 Shell \u2714\ufe0f \uae30\uc874 \uc608\uc81c \ucf54\ub4dc \ucc38\uace0\ud574\uc11c \ubcf5\ubd99, \uc8fc\uc11d \ucd94\uac00\ub85c \uad6c\uc870 \uc774\ud574 \u2714\ufe0f \uacb0\uad6d Buildroot \uc218\uc900\uae4c\uc9c0 \ubaa9\ud45c \u2192 rootfs \ub9cc\ub4e4\uc5b4 BusyBox, \ub124\ud2b8\uc6cc\ud06c \ucd94\uac00</p>"},{"location":"qemu/#_1","title":"&gt; \uc124\uce58","text":"<pre><code>~$ sudo apt install qemu-system-aarch64         #qemu arm64 \uc124\uce58\n~$ qemu-system-aarch64 --version                #\uc124\uce58 \ud655\uc778\nQEMU emulator version 6.2.0 (Debian 1:6.2+dfsg-2ubuntu6.26)\n\n~$ sudo apt install gcc-aarch64-linux-gnu       #\ud06c\ub85c\uc2a4\ucef4\ud30c\uc77c\ub7ec \uc124\uce58   \n~$ aarch64-linux-gnu-gcc --version              #\uc124\uce58 \ud655\uc778\naarch64-linux-gnu-gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0\n</code></pre>"},{"location":"qemu/#_2","title":"&gt; \ub9cc\ub4e4 \uad6c\uc870","text":"<p>baremetal/ \u251c\u2500\u2500 Makefile \u251c\u2500\u2500 link.ld \u251c\u2500\u2500 start.S               # \ubd80\ud2b8 \ucf54\ub4dc(\ucd08\uae30\ud654) \u251c\u2500\u2500 include/              # \ud5e4\ub354\ud30c\uc77c \u2502   \u251c\u2500\u2500 uart.h            # UART \ud5e4\ub354 \u2502   \u251c\u2500\u2500 timer.h           # Timer \ud5e4\ub354 \u2502   \u2514\u2500\u2500 mmu.h             # MMU \ud5e4\ub354 \u251c\u2500\u2500 drivers/              # \ud558\ub4dc\uc6e8\uc5b4 \ub4dc\ub77c\uc774\ubc84 \ubaa8\uc74c \u2502   \u251c\u2500\u2500 uart.c \u2502   \u251c\u2500\u2500 timer.c \u2502   \u2514\u2500\u2500 mmu.c \u251c\u2500\u2500 kernel/               # \ucee4\ub110 \ub85c\uc9c1 \u2502   \u251c\u2500\u2500 main.c            # \uc9c4\uc785\uc810, \ucd08\uae30\ud654 \uc21c\uc11c \u2502   \u251c\u2500\u2500 shell.c          # Shell \u2502   \u2514\u2500\u2500 scheduler.c     # (\ub098\uc911\uc5d0 \ucd94\uac00) \u2514\u2500\u2500 build/                # \ube4c\ub4dc \uc0b0\ucd9c\ubb3c     \u251c\u2500\u2500 kernel.elf     \u2514\u2500\u2500 kernel.img</p>"},{"location":"qemu/#_3","title":"&gt; \ubaa8\ub4c8 \uc124\uba85","text":"<p>UART : \uc9c1\uc811 \ub808\uc9c0\uc2a4\ud130\uc5d0 \uac12 \uc4f0\uae30 \u2192 \ucd9c\ub825 Timer : \uc778\ud130\ub7fd\ud2b8 \u2192 tick \ubc1c\uc0dd MMU : \ud398\uc774\uc9c0 \ud14c\uc774\ube14 \u2192 \uc8fc\uc18c \ubcc0\ud658 Shell : UART I/O\ub85c \uae30\ubcf8 \uba85\ub839\uc5b4 \uc778\ud130\ud504\ub9ac\ud130</p>"},{"location":"qemu/#_4","title":"&gt; \uc8fc\uc18c","text":"<p>qemu virt machine \uae30\uc900</p> <p>0x09000000: UART0 (\uc9c1\ub82c \ud1b5\uc2e0 \uc7a5\uce58. \ucef4\ud4e8\ud130\uc640 \ud130\ubbf8\ub110 \uac04 \ud14d\uc2a4\ud2b8 \uc8fc\uace0\ubc1b\uc744 \ub54c \uc0ac\uc6a9) 0x08000000: GIC (\uc778\ud130\ub7fd\ud2b8 \uad00\ub9ac \ucee8\ud2b8\ub864\ub7ec. timer, uart, virtio \ub4f1 \ud558\ub4dc\uc6e8\uc5b4 \uc778\ud130\ub819\ud2b8\ub97c gic\uac00 \ubc1b\uc544\uc11c cpu\uc5d0 \uc804\ub2ec) 0x0A000000: Virtio (\uac00\uc0c1\ud654 \ub514\ubc14\uc774\uc2a4 \uc778\ud130\ud398\uc774\uc2a4. \ub124\ud2b8\uc6cc\ud06c, \ube14\ub85d \ub514\ubc14\uc774\uc2a4 \ub4f1) 0x40000000: DRAM \uc2dc\uc791 \uc8fc\uc18c. \uc5ec\uae30\ubd80\ud130 \uba54\ubaa8\ub9ac \uadf8 \uc0ac\uc774: bootloader, MMU, DTB \ub85c\ub4dc 0x40080000: OS/\ucee4\ub110 \uc774\ubbf8\uc9c0 \ub85c\ub529 \uc8fc\uc18c. \ucf54\ub4dc(.text) \uadf8 \ub4a4\ub85c \ub370\uc774\ud130,</p> <p>[ \ud504\ub85c\uadf8\ub7a8\uc758 \uba54\ubaa8\ub9ac \uacf5\uac04 ] \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502 \ubca1\ud130 \ud14c\uc774\ube14     \u2502  \u2190 \uc778\ud130\ub7fd\ud2b8 \ucc98\ub9ac \ud568\uc218 \ud3ec\uc778\ud130\ub4e4 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \ucf54\ub4dc (.text)   \u2502  \u2190 \uc2e4\ud589 \uba85\ub839\uc5b4(\ud38c\uc6e8\uc5b4, \ucee4\ub110, \uc571) \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \uc0c1\uc218 (.rodata) \u2502  \u2190 \uc0c1\uc218 \ubb38\uc790\uc5f4, \ud14c\uc774\ube14 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \ub370\uc774\ud130 (.data) \u2502  \u2190 \uc804\uc5ed \ubcc0\uc218 (\ucd08\uae30\uac12 \uc788\uc74c) \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 BSS (.bss)    \u2502  \u2190 \uc804\uc5ed \ubcc0\uc218 (\ucd08\uae30\uac12 0) \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \ud799 (heap)     \u2502  \u2190 malloc, new \ub4f1 \ub3d9\uc801\ud560\ub2f9 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502 \uc2a4\ud0dd (stack)   \u2502  \u2190 \ud568\uc218 \ud638\ucd9c, \uc9c0\uc5ed \ubcc0\uc218 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518</p> <pre><code>~$ cat &gt; link.ld                      #link.ld \uc0dd\uc131\nSECTIONS\n{\n    . = 0x40080000; /* QEMU virt machine\uc5d0\uc11c \uae30\ubcf8 \ub85c\ub4dc\uc8fc\uc18c */\n    .text : { *(.text*) }\n    .rodata : { *(.rodata*) }\n    .data : { *(.data*) }\n    .bss : { *(.bss*) }\n}\nCtrl+D\n</code></pre>"},{"location":"qemu/#arm64","title":"&gt; arm64 \ud2b9\uc131","text":"<ol> <li>\ubc14\uc774\ud2b8 \uc21c\uc11c: little endian\uc0ac\uc6a9. 0x12345678\uc740 \uba54\ubaa8\ub9ac\uc5d0 78 56 34 12 \uc21c\uc11c\ub85c \uc800\uc7a5.</li> <li>\uba54\ubaa8\ub9ac \uc815\ub82c: 4\ubc14\uc774\ud2b8 \ub2e8\uc704\uc758 word alignment\uac00 \uae30\ubcf8. 0x40080001\uac19\uc740\uac74 \uc815\ub82c\ub418\uc9c0 \uc54a\uc740 \uc8fc\uc18c.</li> <li>\ub808\uc9c0\uc2a4\ud130: x0 ~ x30\uc740 \ubc94\uc6a9 \ub808\uc9c0\uc2a4\ud130, sp\ub294 \uc2a4\ud0dd \ud3ec\uc778\ud130, pc\ub294 \ud504\ub85c\uadf8\ub7a8 \uce74\uc6b4\ud130, VBAR_EL1\uc740 \uc778\ud130\ub7fd\ud2b8 \ubca1\ud130 \ubca0\uc774\uc2a4, TTBR_EL1\uc740 \ud398\uc774\uc9c0 \ud14c\uc774\ube14 \ubca0\uc774\uc2a4, SCTLR_EL1\uc740 \uc2dc\uc2a4\ud15c \uc81c\uc5b4 \ub808\uc9c0\uc2a4\ud130(MMU,\uce90\uc2dc \ucf1c\uae30)</li> <li>\ud568\uc218 \ud638\ucd9c \uaddc\uc57d: \ub9ac\ud134\uac12\uc740 x0, \ud30c\ub77c\uba54\ud130 x0~x7. \uc2a4\ud0dd\uc740 16\ubc14\uc774\ud2b8 \uc815\ub82c(align 16)</li> </ol>"},{"location":"qemu/#qemu","title":"&gt; qemu \ud14c\uc2a4\ud2b8","text":"<p>[ hello.S ] --(\uc5b4\uc148\ube14\ub7ec)--&gt; [ hello.o ] --(\ub9c1\ucee4)--&gt; [ kernel.elf ] --(objcopy)--&gt; [ kernel.img ] \uc5b4\uc148\ube14\ub9ac \u2192 \uc624\ube0c\uc81d\ud2b8 : CPU\uac00 \uc774\ud574\ud560 \uc218 \uc788\ub294 \uae30\uacc4\uc5b4(.o)\ub85c \ubcc0\ud658 \uc624\ube0c\uc81d\ud2b8 \u2192 ELF \uc2e4\ud589\ud30c\uc77c : \ucf54\ub4dc\uc640 \ub370\uc774\ud130(\uc139\uc158)\ub4e4\uc744 \uc8fc\uc18c\uc5d0 \ub9de\uac8c \ubc30\uce58 ELF \u2192 \ubc14\uc774\ub108\ub9ac \uc774\ubbf8\uc9c0 : ELF \ud5e4\ub354 \uc81c\uac70, \ubd80\ud2b8\ub85c\ub354/\uc5d0\ubbac\ub808\uc774\ud130\uac00 \ubc14\ub85c \uc77d\uc744 \uc218 \uc788\uac8c</p> <pre><code>~$ cat &gt; test.S                      #test.S \uc0dd\uc131\n.section .text\n.globl _start\n_start:\n\n    b .\nCtrl+D\n</code></pre> <pre><code>~$ aarch64-linux-gnu-as hello.S -o hello.o                      #\uc5b4\uc148\ube14\ub9ac&gt;\uc624\ube0c\uc81d\ud2b8\n~$ aarch64-linux-gnu-ld -T link.ld hello.o -o kernel.elf        #\ub9c1\ucee4\n~$ aarch64-linux-gnu-objcopy -O binary kernel.elf kernel.img    #\ubc14\uc774\ub108\ub9ac\ub85c \ubcc0\ud658\n\n~$ qemu-system-aarch64 \\\n    -M virt \\                                                   #\ud45c\uc900 ARM64 \uac00\uc0c1\uba38\uc2e0\n    -cpu cortex-a53 \\                                           #ARM64 CPU\n    -nographic \\                                                #\uc2dc\ub9ac\uc5bc\ub85c\ub9cc \uc785\ucd9c\ub825\n    -kernel kernel8.img                                         #\ucee4\ub110 \ubc14\uc774\ub108\ub9ac \uc9c0\uc815\nCtrl+A X\n</code></pre> <pre><code>~$ ps aux | grep qemu           #\uc2e4\ud589\uc911\uc778 \ud504\ub85c\uc138\uc2a4 \ubc88\ud638\n~$ kill \uc22b\uc790                     #\uac15\uc81c\uc885\ub8cc\n</code></pre>"},{"location":"qemu/#makefile","title":"&gt; Makefile","text":"<p>\uc704 \uacfc\uc815\uc744 \ud558\ub098\ub85c \uc815\ub9ac</p>"},{"location":"qemu/#_5","title":"&gt; \ub514\ubc84\uae45","text":"<p>\ub2e4\ub978 \ud130\ubbf8\ub110\uc5d0\uc11c gdb-multiarch ~/make-os/kernel.elf (gdb) target remote localhost:1234  #\uc5f0\uacb0 (gdb) continue                      #\ucf54\ub4dc \uc2e4\ud589 (gdb) quit                          #\uadf8\ub9cc\ub450\uba74 \uba48\ucd98 \uc8fc\uc18c \ub098\ud0c0\ub0a8 (gdb) info registers                #\ub808\uc9c0\uc2a4\ud130 \uc815\ubcf4 (gdb) disassemble                   #\uc5b4\uc148\ube14\ub9ac \ucf54\ub4dc \ubcf4\uae30 (gdb) x/i $pc                       #\ud604\uc7ac \uc704\uce58(pc)</p>"},{"location":"qemu/#uart","title":"&gt; Uart","text":"<ol> <li>\uc804\uc6d0 On \u2192 \ucee4\ub110 \ucf54\ub4dc \uc2e4\ud589</li> <li>UART\ub85c \"Hello\" \uac19\uc740 \ubb38\uc790 \ucd9c\ub825</li> <li>Timer\ub97c \uc124\uc815\ud574\uc11c \"1\ucd08\ub9c8\ub2e4 \uc778\ud130\ub7fd\ud2b8(IRQ) \uc8fc\uc138\uc694\"\ub77c\uace0 \uc694\uccad</li> <li>\uc9c4\uc9dc 1\ucd08\ub9c8\ub2e4 CPU\ud55c\ud14c \uc778\ud130\ub7fd\ud2b8\uac00 \uc624\uba74 \u2192 \uc6b0\ub9ac\uac00 \ub9cc\ub4e0 \ud568\uc218(IRQ \ud578\ub4e4\ub7ec) \ud638\ucd9c\ub428</li> <li>\uac70\uae30\uc11c UART\ub85c \"Tick!\" \ucd9c\ub825</li> </ol> <p>\u2705 \uc804\uccb4 \ud750\ub984 \uc694\uc57d: Tick \ucd9c\ub825\uc774 \ub098\uc624\uae30\uae4c\uc9c0</p> <p>\ud83e\uddf1 0. QEMU \uc2e4\ud589</p> <pre><code>qemu-system-aarch64 -M virt -cpu cortex-a53 -nographic -kernel kernel.img\n</code></pre> <ul> <li>QEMU\ub294 \ucee4\ub110 \ubc14\uc774\ub108\ub9ac\ub97c <code>0x40080000</code>\uc5d0 \ub85c\ub4dc\ud558\uace0,</li> <li><code>_start</code>\ub77c\ub294 \uc2ec\ubcfc(\uc2dc\uc791 \uc8fc\uc18c)\ubd80\ud130 \uc2e4\ud589\uc744 \uc2dc\uc791\ud568.</li> </ul> <p>\ud83d\udd25 1. <code>_start</code> \uc2e4\ud589 (start.S)</p> \ub3d9\uc791 \uc124\uba85 <code>sp</code> \uc124\uc815 \uc2a4\ud0dd \ucd08\uae30\ud654 (<code>_stack_top</code>\uc744 <code>sp</code>\ub85c \uc124\uc815) <code>VBAR_EL1 = vector_table</code> \uc778\ud130\ub7fd\ud2b8 \ubca1\ud130 \ud14c\uc774\ube14 \uc8fc\uc18c \ub4f1\ub85d <code>DAIFClr, #0xf</code> \ubaa8\ub4e0 \uc778\ud130\ub7fd\ud2b8 \ud5c8\uc6a9 (IRQ, FIQ, SError \ub4f1) <code>bl main</code> C \ucf54\ub4dc \uc9c4\uc785\uc810 <code>main()</code> \ud638\ucd9c <p>\u2699\ufe0f 2. <code>main()</code> \uc9c4\uc785 (main.c)</p> <pre><code>void main(void) {\n    uart_puts(\"Starting Timer...\\n\");\n\n    gic_init();   // GIC \uc778\ud130\ub7fd\ud2b8 \ucee8\ud2b8\ub864\ub7ec \ucd08\uae30\ud654\n    timer_init(); // 1\ucd08 \ub4a4 IRQ 30 \uc778\ud130\ub7fd\ud2b8 \uc124\uc815\n\n    while (1) {}  // \ubb34\ud55c \ub300\uae30 (\uc778\ud130\ub7fd\ud2b8\ub9cc \ucc98\ub9ac\ud568)\n}\n</code></pre> <p>\ud83d\udee0\ufe0f 3. GIC \ucd08\uae30\ud654 (gic.c)</p> \ub3d9\uc791 \uc124\uba85 <code>GICD_CTLR = 1</code> Distributor \ucf2c (\uc804\uc5ed \uc778\ud130\ub7fd\ud2b8 \uad00\ub9ac\uc790) <code>GICC_CTLR = 1</code> CPU Interface \ucf2c (CPU\ub85c \uc778\ud130\ub7fd\ud2b8 \uc804\ub2ec \ud5c8\uc6a9) <code>GICD_ISENABLER0 |= (1 &lt;&lt; 30)</code> IRQ ID 30 (\ud0c0\uc774\uba38 \uc778\ud130\ub7fd\ud2b8)\ub9cc \ud5c8\uc6a9 <p>\u23f1\ufe0f 4. Timer \ucd08\uae30\ud654 (timer.c)</p> \ub3d9\uc791 \uc124\uba85 <code>cntfrq_el0</code> \uc77d\uae30 \ud0c0\uc774\uba38 \uc8fc\ud30c\uc218 (ex. 62.5MHz) <code>cntp_tval_el0 = cntfrq</code> 1\ucd08 \ud6c4 \uc778\ud130\ub7fd\ud2b8 \ubc1c\uc0dd \uc608\uc57d <code>cntp_ctl_el0 = 1</code> \ud0c0\uc774\uba38 \uc2dc\uc791 (IRQ \ubc1c\uc0dd \uac00\ub2a5) <p>\ud83d\udca4 5. \uba54\uc778 \ub8e8\ud504 \uc9c4\uc785 - <code>main()</code>\uc740 <code>while(1)</code> \ub8e8\ud504\uc5d0 \uc9c4\uc785\ud558\uc5ec \uc544\ubb34 \uc77c\ub3c4 \ud558\uc9c0 \uc54a\uc74c - \uc774\ud6c4\uc758 \ub3d9\uc791\uc740 \uc778\ud130\ub7fd\ud2b8\uc5d0 \uc758\ud574\uc11c\ub9cc \ubc1c\uc0dd\ud568</p> <p>\u26a1 6. 1\ucd08 \ud6c4 \ud0c0\uc774\uba38 \uc778\ud130\ub7fd\ud2b8 \ubc1c\uc0dd - \ud0c0\uc774\uba38 \ub0b4\ubd80\uc801\uc73c\ub85c <code>cntp_tval_el0</code>\uc5d0\uc11c \uce74\uc6b4\ud2b8 \uac10\uc18c - 0\uc5d0 \ub3c4\ub2ec\ud558\uba74 IRQ 30\ubc88 \ubc1c\uc0dd - CPU\ub294 \ubca1\ud130 \ud14c\uc774\ube14\uc744 \ub530\ub77c <code>irq_handler</code> \uc2e4\ud589</p> <p>\ud83e\udded 7. \ubca1\ud130 \ud14c\uc774\ube14 \uc9c4\uc785 (start.S)</p> <pre><code>vector_table:\n    b sync_handler       // Synchronous Exception\n    b irq_handler        // IRQ \ubc1c\uc0dd \uc2dc \uc5ec\uae30\uac00 \uc2e4\ud589\ub428\n    b fiq_handler        // FIQ\n    b error_handler      // SError\n\nirq_handler:\n    bl irq_handler_c     // \uc2e4\uc81c C \ud578\ub4e4\ub7ec \ud638\ucd9c\n    eret                 // \ubcf5\uadc0\n</code></pre> <p>\ud83d\udce6 8. <code>irq_handler_c()</code> \uc2e4\ud589 (main.c)</p> <pre><code>unsigned int intid = gic_acknowledge();  // IRQ ID \uc77d\uae30\n\nuart_puts(\"IRQ ID: \");\nprint_dec(intid);                        // \"IRQ ID: 30\" \ucd9c\ub825\n\nif (intid == 30) {\n    uart_puts(\"Tick!\\n\");               // \"Tick!\" \ucd9c\ub825\n    timer_init();                        // \ub2e4\uc2dc \ud0c0\uc774\uba38 \uc7ac\uc124\uc815 (1\ucd08 \ud6c4 \ubc18\ubcf5)\n}\n\ngic_eoi(intid);                          // GIC\uc5d0 \ucc98\ub9ac \uc644\ub8cc \uc54c\ub9bc\n</code></pre> <p>\ud83d\udd01 9. \ub8e8\ud504 \ubc18\ubcf5 - \ub2e4\uc2dc \ud0c0\uc774\uba38 \uc124\uc815\ub428 (<code>timer_init()</code> \ud638\ucd9c) - \ub610 1\ucd08 \ub4a4 IRQ 30 \ubc1c\uc0dd \u2192 \uc704 \uacfc\uc815 \ubc18\ubcf5</p> <p>.section .text .global _start</p> <p>_start:     // \ubca1\ud130 \ud14c\uc774\ube14 \ub4f1\ub85d     ldr x0, =vector_table     msr VBAR_EL1, x0     isb</p> <pre><code>// GIC \ucd08\uae30\ud654\nbl gic_init\n\n// CNTV Timer \uc124\uc815 (1\ucd08)\nldr x1, =0x3B9ACA00      // 1,000,000,000 ticks\nmsr cntv_tval_el0, x1\nmov x2, #1\nmsr cntv_ctl_el0, x2\n\n// IRQ \uc5b8\ub9c8\uc2a4\ud06c\nmsr DAIFClr, #2\n</code></pre> <p>1:  wfe     b 1b</p> <p>.align 11 vector_table:     // Synchronous EL1t     b default_handler     .space 0x80 - 4</p> <pre><code>// IRQ EL1t\nb default_handler\n.space 0x80 - 4\n\n// FIQ EL1t\nb default_handler\n.space 0x80 - 4\n\n// SError EL1t\nb default_handler\n.space 0x80 - 4\n\n// Synchronous EL1h\nb default_handler\n.space 0x80 - 4\n\n// IRQ EL1h\nb irq_handler\n.space 0x80 - 4\n\n// FIQ EL1h\nb default_handler\n.space 0x80 - 4\n\n// SError EL1h\nb default_handler\n.space 0x80 - 4\n</code></pre> <p>default_handler:     b .</p> <p>irq_handler:     // \uba54\uc2dc\uc9c0 \ucd9c\ub825     ldr x0, =tick_msg print_loop:     ldrb w1, [x0], #1     cbz w1, tick_done     bl putc     b print_loop</p> <p>tick_done:     // \ud0c0\uc774\uba38 \uc7ac\uc124\uc815     ldr x1, =0x3B9ACA00     msr cntv_tval_el0, x1</p> <pre><code>// \uc778\ud130\ub7fd\ud2b8 EOI \ucc98\ub9ac\nldr x0, =0x08010010\nmov w1, #27            // Timer IRQ ID 27\nstr w1, [x0]\n\neret\n</code></pre> <p>putc:     ldr x2, =0x09000000    // UART MMIO wait_uart:     ldr w3, [x2, #0x18]     tst w3, #0x20     b.ne wait_uart     str w1, [x2]     ret</p> <p>gic_init:     ldr x0, =0x08000000    // GIC Distributor     mov w1, #1     str w1, [x0]           // GICD_CTLR</p> <pre><code>add x1, x0, #0x100     // GICD_ISENABLER0\nmov w2, #(1 &lt;&lt; 27)     // Timer IRQ ID 27\nstr w2, [x1]\n\nldr x0, =0x08010000    // GICC base\nmov w1, #1\nstr w1, [x0]           // GICC_CTLR\n\nadd x1, x0, #0x4       // GICC_PMR\nmov w2, #0xFF\nstr w2, [x1]\n\nret\n</code></pre> <p>tick_msg:     .asciz \"Tick!\\n\"</p> <p>\uacb0\uacfc Tick! Tick! Tick!</p>"},{"location":"qemu/#mmu","title":"&gt; mmu(\uba54\ubaa8\ub9ac \ub9e4\ub2c8\uc9c0\uba3c\ud2b8 \uc720\ub2db)","text":"<p>\ubb3c\ub9ac \uc8fc\uc18c\uc640 \uac00\uc0c1 \uc8fc\uc18c\ub97c \ub9e4\ud551\ud574\uc900\ub2e4. \ub530\ub77c\uc11c \uc720\uc800\ubaa8\ub4dc/\ucee4\ub110\ubaa8\ub4dc\ub97c \ubd84\ub9ac\ud558\uc5ec \ud504\ub85c\uc138\uc2a4\ub97c \uaca9\ub9ac\ud558\uace0 \uba54\ubaa8\ub9ac\ub97c \ubcf4\ud638\ud55c\ub2e4. step 1. \ud398\uc774\uc9c0 \ud14c\uc774\ube14 \uc900\ube44 arm64\uc5d0\uc11c\ub294 \uae30\ubcf8\uc73c\ub85c L1 -&gt; L2 -&gt; L3 \ud14c\uc774\ube14\ub85c \uacc4\uce35\ud654\ub97c \ud558\uc9c0\ub9cc \uc5ec\uae30\uc120 identity mapping\uc73c\ub85c \uad6c\uc131 step 2. mmu \ub808\uc9c0\uc2a4\ud130 TTBRO_EL1 : \ud398\uc774\uc9c0 \ud14c\uc774\ube14 \ubca0\uc774\uc2a4 \uc8fc\uc18c TCR_EL1 : \uc8fc\uc18c \ud06c\uae30 \uc124\uc815 MAIR_EL1 : \uba54\ubaa8\ub9ac \uc18d\uc131 SCTLR_EL1 : mmu \ud65c\uc131\ud654</p>"}]}