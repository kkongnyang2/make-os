
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>ì´ë¡  - make-os</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="make-os" class="md-header__button md-logo" aria-label="make-os" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            make-os
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ì´ë¡ 
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="make-os" class="md-nav__button md-logo" aria-label="make-os" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    make-os
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ì´ë¡ 
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ì´ë¡ 
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ì„¤ì¹˜
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ë§Œë“¤ êµ¬ì¡°
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ëª¨ë“ˆ ì„¤ëª…
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ì£¼ì†Œ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arm64" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; arm64 íŠ¹ì„±
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qemu" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; qemu í…ŒìŠ¤íŠ¸
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; Makefile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ë””ë²„ê¹…
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uart" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; Uart
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mmu" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; mmu(ë©”ëª¨ë¦¬ ë§¤ë‹ˆì§€ë¨¼íŠ¸ ìœ ë‹›)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ì„¤ì¹˜
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ë§Œë“¤ êµ¬ì¡°
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ëª¨ë“ˆ ì„¤ëª…
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ì£¼ì†Œ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arm64" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; arm64 íŠ¹ì„±
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#qemu" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; qemu í…ŒìŠ¤íŠ¸
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#makefile" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; Makefile
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; ë””ë²„ê¹…
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#uart" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; Uart
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mmu" class="md-nav__link">
    <span class="md-ellipsis">
      &gt; mmu(ë©”ëª¨ë¦¬ ë§¤ë‹ˆì§€ë¨¼íŠ¸ ìœ ë‹›)
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>ì´ë¡ </h1>

<p>âœ… ìµœì¢… ì •ë¦¬</p>
<p>âœ”ï¸ ëª©í‘œ: Bare-metalì—ì„œ í•˜ë“œì›¨ì–´ ì œì–´<br />
âœ”ï¸ í…ŒìŠ¤íŠ¸ í™˜ê²½: QEMU ARM64 Virt Machine (LED ëŒ€ì‹  UART ì¶œë ¥)<br />
âœ”ï¸ ë°©ë²•: Bare-metal â†’ UART â†’ Timer â†’ MMU â†’ Shell<br />
âœ”ï¸ ê¸°ì¡´ ì˜ˆì œ ì½”ë“œ ì°¸ê³ í•´ì„œ ë³µë¶™, ì£¼ì„ ì¶”ê°€ë¡œ êµ¬ì¡° ì´í•´<br />
âœ”ï¸ ê²°êµ­ Buildroot ìˆ˜ì¤€ê¹Œì§€ ëª©í‘œ â†’ rootfs ë§Œë“¤ì–´ BusyBox, ë„¤íŠ¸ì›Œí¬ ì¶”ê°€</p>
<h3 id="_1">&gt; ì„¤ì¹˜<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>~$ sudo apt install qemu-system-aarch64         #qemu arm64 ì„¤ì¹˜
~$ qemu-system-aarch64 --version                #ì„¤ì¹˜ í™•ì¸
QEMU emulator version 6.2.0 (Debian 1:6.2+dfsg-2ubuntu6.26)

~$ sudo apt install gcc-aarch64-linux-gnu       #í¬ë¡œìŠ¤ì»´íŒŒì¼ëŸ¬ ì„¤ì¹˜   
~$ aarch64-linux-gnu-gcc --version              #ì„¤ì¹˜ í™•ì¸
aarch64-linux-gnu-gcc (Ubuntu 11.4.0-1ubuntu1~22.04) 11.4.0
</code></pre></div>
<h3 id="_2">&gt; ë§Œë“¤ êµ¬ì¡°<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>baremetal/<br />
â”œâ”€â”€ Makefile<br />
â”œâ”€â”€ link.ld<br />
â”œâ”€â”€ start.S               # ë¶€íŠ¸ ì½”ë“œ(ì´ˆê¸°í™”)<br />
â”œâ”€â”€ include/              # í—¤ë”íŒŒì¼<br />
â”‚   â”œâ”€â”€ uart.h            # UART í—¤ë”<br />
â”‚   â”œâ”€â”€ timer.h           # Timer í—¤ë”<br />
â”‚   â””â”€â”€ mmu.h             # MMU í—¤ë”<br />
â”œâ”€â”€ drivers/              # í•˜ë“œì›¨ì–´ ë“œë¼ì´ë²„ ëª¨ìŒ<br />
â”‚   â”œâ”€â”€ uart.c<br />
â”‚   â”œâ”€â”€ timer.c<br />
â”‚   â””â”€â”€ mmu.c<br />
â”œâ”€â”€ kernel/               # ì»¤ë„ ë¡œì§<br />
â”‚   â”œâ”€â”€ main.c            # ì§„ì…ì , ì´ˆê¸°í™” ìˆœì„œ<br />
â”‚   â”œâ”€â”€ shell.c          # Shell<br />
â”‚   â””â”€â”€ scheduler.c     # (ë‚˜ì¤‘ì— ì¶”ê°€)<br />
â””â”€â”€ build/                # ë¹Œë“œ ì‚°ì¶œë¬¼<br />
    â”œâ”€â”€ kernel.elf<br />
    â””â”€â”€ kernel.img</p>
<h3 id="_3">&gt; ëª¨ë“ˆ ì„¤ëª…<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>UART : ì§ì ‘ ë ˆì§€ìŠ¤í„°ì— ê°’ ì“°ê¸° â†’ ì¶œë ¥<br />
Timer : ì¸í„°ëŸ½íŠ¸ â†’ tick ë°œìƒ<br />
MMU : í˜ì´ì§€ í…Œì´ë¸” â†’ ì£¼ì†Œ ë³€í™˜<br />
Shell : UART I/Oë¡œ ê¸°ë³¸ ëª…ë ¹ì–´ ì¸í„°í”„ë¦¬í„°</p>
<h3 id="_4">&gt; ì£¼ì†Œ<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>qemu virt machine ê¸°ì¤€</p>
<p>0x09000000: UART0 (ì§ë ¬ í†µì‹  ì¥ì¹˜. ì»´í“¨í„°ì™€ í„°ë¯¸ë„ ê°„ í…ìŠ¤íŠ¸ ì£¼ê³ ë°›ì„ ë•Œ ì‚¬ìš©)<br />
0x08000000: GIC (ì¸í„°ëŸ½íŠ¸ ê´€ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬. timer, uart, virtio ë“± í•˜ë“œì›¨ì–´ ì¸í„°ë ™íŠ¸ë¥¼ gicê°€ ë°›ì•„ì„œ cpuì— ì „ë‹¬)<br />
0x0A000000: Virtio (ê°€ìƒí™” ë””ë°”ì´ìŠ¤ ì¸í„°í˜ì´ìŠ¤. ë„¤íŠ¸ì›Œí¬, ë¸”ë¡ ë””ë°”ì´ìŠ¤ ë“±)<br />
0x40000000: DRAM ì‹œì‘ ì£¼ì†Œ. ì—¬ê¸°ë¶€í„° ë©”ëª¨ë¦¬<br />
ê·¸ ì‚¬ì´: bootloader, MMU, DTB ë¡œë“œ<br />
0x40080000: OS/ì»¤ë„ ì´ë¯¸ì§€ ë¡œë”© ì£¼ì†Œ. ì½”ë“œ(.text)<br />
ê·¸ ë’¤ë¡œ ë°ì´í„°,</p>
<p>[ í”„ë¡œê·¸ë¨ì˜ ë©”ëª¨ë¦¬ ê³µê°„ ]<br />
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br />
â”‚ ë²¡í„° í…Œì´ë¸”     â”‚  â† ì¸í„°ëŸ½íŠ¸ ì²˜ë¦¬ í•¨ìˆ˜ í¬ì¸í„°ë“¤<br />
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br />
â”‚ ì½”ë“œ (.text)   â”‚  â† ì‹¤í–‰ ëª…ë ¹ì–´(íŒì›¨ì–´, ì»¤ë„, ì•±)<br />
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br />
â”‚ ìƒìˆ˜ (.rodata) â”‚  â† ìƒìˆ˜ ë¬¸ìì—´, í…Œì´ë¸”<br />
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br />
â”‚ ë°ì´í„° (.data) â”‚  â† ì „ì—­ ë³€ìˆ˜ (ì´ˆê¸°ê°’ ìˆìŒ)<br />
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br />
â”‚ BSS (.bss)    â”‚  â† ì „ì—­ ë³€ìˆ˜ (ì´ˆê¸°ê°’ 0)<br />
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br />
â”‚ í™ (heap)     â”‚  â† malloc, new ë“± ë™ì í• ë‹¹<br />
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br />
â”‚ ìŠ¤íƒ (stack)   â”‚  â† í•¨ìˆ˜ í˜¸ì¶œ, ì§€ì—­ ë³€ìˆ˜<br />
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</p>
<div class="highlight"><pre><span></span><code>~$ cat &gt; link.ld                      #link.ld ìƒì„±
SECTIONS
{
    . = 0x40080000; /* QEMU virt machineì—ì„œ ê¸°ë³¸ ë¡œë“œì£¼ì†Œ */
    .text : { *(.text*) }
    .rodata : { *(.rodata*) }
    .data : { *(.data*) }
    .bss : { *(.bss*) }
}
Ctrl+D
</code></pre></div>
<h3 id="arm64">&gt; arm64 íŠ¹ì„±<a class="headerlink" href="#arm64" title="Permanent link">&para;</a></h3>
<ol>
<li>ë°”ì´íŠ¸ ìˆœì„œ: little endianì‚¬ìš©. 0x12345678ì€ ë©”ëª¨ë¦¬ì— 78 56 34 12 ìˆœì„œë¡œ ì €ì¥.</li>
<li>ë©”ëª¨ë¦¬ ì •ë ¬: 4ë°”ì´íŠ¸ ë‹¨ìœ„ì˜ word alignmentê°€ ê¸°ë³¸. 0x40080001ê°™ì€ê±´ ì •ë ¬ë˜ì§€ ì•Šì€ ì£¼ì†Œ.</li>
<li>ë ˆì§€ìŠ¤í„°: x0 ~ x30ì€ ë²”ìš© ë ˆì§€ìŠ¤í„°, spëŠ” ìŠ¤íƒ í¬ì¸í„°, pcëŠ” í”„ë¡œê·¸ë¨ ì¹´ìš´í„°, VBAR_EL1ì€ ì¸í„°ëŸ½íŠ¸ ë²¡í„° ë² ì´ìŠ¤, TTBR_EL1ì€ í˜ì´ì§€ í…Œì´ë¸” ë² ì´ìŠ¤, SCTLR_EL1ì€ ì‹œìŠ¤í…œ ì œì–´ ë ˆì§€ìŠ¤í„°(MMU,ìºì‹œ ì¼œê¸°)</li>
<li>í•¨ìˆ˜ í˜¸ì¶œ ê·œì•½: ë¦¬í„´ê°’ì€ x0, íŒŒë¼ë©”í„° x0~x7. ìŠ¤íƒì€ 16ë°”ì´íŠ¸ ì •ë ¬(align 16)</li>
</ol>
<hr />
<h3 id="qemu">&gt; qemu í…ŒìŠ¤íŠ¸<a class="headerlink" href="#qemu" title="Permanent link">&para;</a></h3>
<p>[ hello.S ] --(ì–´ì…ˆë¸”ëŸ¬)--&gt; [ hello.o ] --(ë§ì»¤)--&gt; [ kernel.elf ] --(objcopy)--&gt; [ kernel.img ]<br />
ì–´ì…ˆë¸”ë¦¬ â†’ ì˜¤ë¸Œì íŠ¸ : CPUê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” ê¸°ê³„ì–´(.o)ë¡œ ë³€í™˜<br />
ì˜¤ë¸Œì íŠ¸ â†’ ELF ì‹¤í–‰íŒŒì¼ : ì½”ë“œì™€ ë°ì´í„°(ì„¹ì…˜)ë“¤ì„ ì£¼ì†Œì— ë§ê²Œ ë°°ì¹˜<br />
ELF â†’ ë°”ì´ë„ˆë¦¬ ì´ë¯¸ì§€ : ELF í—¤ë” ì œê±°, ë¶€íŠ¸ë¡œë”/ì—ë®¬ë ˆì´í„°ê°€ ë°”ë¡œ ì½ì„ ìˆ˜ ìˆê²Œ</p>
<div class="highlight"><pre><span></span><code>~$ cat &gt; test.S                      #test.S ìƒì„±
.section .text
.globl _start
_start:

    b .
Ctrl+D
</code></pre></div>
<div class="highlight"><pre><span></span><code>~$ aarch64-linux-gnu-as hello.S -o hello.o                      #ì–´ì…ˆë¸”ë¦¬&gt;ì˜¤ë¸Œì íŠ¸
~$ aarch64-linux-gnu-ld -T link.ld hello.o -o kernel.elf        #ë§ì»¤
~$ aarch64-linux-gnu-objcopy -O binary kernel.elf kernel.img    #ë°”ì´ë„ˆë¦¬ë¡œ ë³€í™˜

~$ qemu-system-aarch64 \
    -M virt \                                                   #í‘œì¤€ ARM64 ê°€ìƒë¨¸ì‹ 
    -cpu cortex-a53 \                                           #ARM64 CPU
    -nographic \                                                #ì‹œë¦¬ì–¼ë¡œë§Œ ì…ì¶œë ¥
    -kernel kernel8.img                                         #ì»¤ë„ ë°”ì´ë„ˆë¦¬ ì§€ì •
Ctrl+A X
</code></pre></div>
<div class="highlight"><pre><span></span><code>~$ ps aux | grep qemu           #ì‹¤í–‰ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ ë²ˆí˜¸
~$ kill ìˆ«ì                     #ê°•ì œì¢…ë£Œ
</code></pre></div>
<hr />
<h3 id="makefile">&gt; Makefile<a class="headerlink" href="#makefile" title="Permanent link">&para;</a></h3>
<p>ìœ„ ê³¼ì •ì„ í•˜ë‚˜ë¡œ ì •ë¦¬</p>
<h3 id="_5">&gt; ë””ë²„ê¹…<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>ë‹¤ë¥¸ í„°ë¯¸ë„ì—ì„œ<br />
gdb-multiarch ~/make-os/kernel.elf<br />
(gdb) target remote localhost:1234  #ì—°ê²°<br />
(gdb) continue                      #ì½”ë“œ ì‹¤í–‰<br />
(gdb) quit                          #ê·¸ë§Œë‘ë©´ ë©ˆì¶˜ ì£¼ì†Œ ë‚˜íƒ€ë‚¨<br />
(gdb) info registers                #ë ˆì§€ìŠ¤í„° ì •ë³´<br />
(gdb) disassemble                   #ì–´ì…ˆë¸”ë¦¬ ì½”ë“œ ë³´ê¸°<br />
(gdb) x/i $pc                       #í˜„ì¬ ìœ„ì¹˜(pc)</p>
<h3 id="uart">&gt; Uart<a class="headerlink" href="#uart" title="Permanent link">&para;</a></h3>
<ol>
<li>ì „ì› On â†’ ì»¤ë„ ì½”ë“œ ì‹¤í–‰</li>
<li>UARTë¡œ "Hello" ê°™ì€ ë¬¸ì ì¶œë ¥</li>
<li>Timerë¥¼ ì„¤ì •í•´ì„œ "1ì´ˆë§ˆë‹¤ ì¸í„°ëŸ½íŠ¸(IRQ) ì£¼ì„¸ìš”"ë¼ê³  ìš”ì²­</li>
<li>ì§„ì§œ 1ì´ˆë§ˆë‹¤ CPUí•œí…Œ ì¸í„°ëŸ½íŠ¸ê°€ ì˜¤ë©´ â†’ ìš°ë¦¬ê°€ ë§Œë“  í•¨ìˆ˜(IRQ í•¸ë“¤ëŸ¬) í˜¸ì¶œë¨</li>
<li>ê±°ê¸°ì„œ UARTë¡œ "Tick!" ì¶œë ¥</li>
</ol>
<p>âœ… ì „ì²´ íë¦„ ìš”ì•½: Tick ì¶œë ¥ì´ ë‚˜ì˜¤ê¸°ê¹Œì§€</p>
<p>ğŸ§± 0. QEMU ì‹¤í–‰<br />
<div class="highlight"><pre><span></span><code>qemu-system-aarch64<span class="w"> </span>-M<span class="w"> </span>virt<span class="w"> </span>-cpu<span class="w"> </span>cortex-a53<span class="w"> </span>-nographic<span class="w"> </span>-kernel<span class="w"> </span>kernel.img
</code></pre></div><br />
- QEMUëŠ” ì»¤ë„ ë°”ì´ë„ˆë¦¬ë¥¼ <code>0x40080000</code>ì— ë¡œë“œí•˜ê³ ,<br />
- <code>_start</code>ë¼ëŠ” ì‹¬ë³¼(ì‹œì‘ ì£¼ì†Œ)ë¶€í„° ì‹¤í–‰ì„ ì‹œì‘í•¨.</p>
<p>ğŸ”¥ 1. <code>_start</code> ì‹¤í–‰ (start.S)</p>
<table>
<thead>
<tr>
<th>ë™ì‘</th>
<th>ì„¤ëª…</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sp</code> ì„¤ì •</td>
<td>ìŠ¤íƒ ì´ˆê¸°í™” (<code>_stack_top</code>ì„ <code>sp</code>ë¡œ ì„¤ì •)</td>
</tr>
<tr>
<td><code>VBAR_EL1 = vector_table</code></td>
<td>ì¸í„°ëŸ½íŠ¸ ë²¡í„° í…Œì´ë¸” ì£¼ì†Œ ë“±ë¡</td>
</tr>
<tr>
<td><code>DAIFClr, #0xf</code></td>
<td>ëª¨ë“  ì¸í„°ëŸ½íŠ¸ í—ˆìš© (IRQ, FIQ, SError ë“±)</td>
</tr>
<tr>
<td><code>bl main</code></td>
<td>C ì½”ë“œ ì§„ì…ì  <code>main()</code> í˜¸ì¶œ</td>
</tr>
</tbody>
</table>
<p>âš™ï¸ 2. <code>main()</code> ì§„ì… (main.c)<br />
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">uart_puts</span><span class="p">(</span><span class="s">&quot;Starting Timer...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">gic_init</span><span class="p">();</span><span class="w">   </span><span class="c1">// GIC ì¸í„°ëŸ½íŠ¸ ì»¨íŠ¸ë¡¤ëŸ¬ ì´ˆê¸°í™”</span>
<span class="w">    </span><span class="n">timer_init</span><span class="p">();</span><span class="w"> </span><span class="c1">// 1ì´ˆ ë’¤ IRQ 30 ì¸í„°ëŸ½íŠ¸ ì„¤ì •</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">  </span><span class="c1">// ë¬´í•œ ëŒ€ê¸° (ì¸í„°ëŸ½íŠ¸ë§Œ ì²˜ë¦¬í•¨)</span>
<span class="p">}</span>
</code></pre></div></p>
<p>ğŸ› ï¸ 3. GIC ì´ˆê¸°í™” (gic.c)</p>
<table>
<thead>
<tr>
<th>ë™ì‘</th>
<th>ì„¤ëª…</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>GICD_CTLR = 1</code></td>
<td>Distributor ì¼¬ (ì „ì—­ ì¸í„°ëŸ½íŠ¸ ê´€ë¦¬ì)</td>
</tr>
<tr>
<td><code>GICC_CTLR = 1</code></td>
<td>CPU Interface ì¼¬ (CPUë¡œ ì¸í„°ëŸ½íŠ¸ ì „ë‹¬ í—ˆìš©)</td>
</tr>
<tr>
<td><code>GICD_ISENABLER0 |= (1 &lt;&lt; 30)</code></td>
<td>IRQ ID 30 (íƒ€ì´ë¨¸ ì¸í„°ëŸ½íŠ¸)ë§Œ í—ˆìš©</td>
</tr>
</tbody>
</table>
<p>â±ï¸ 4. Timer ì´ˆê¸°í™” (timer.c)</p>
<table>
<thead>
<tr>
<th>ë™ì‘</th>
<th>ì„¤ëª…</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cntfrq_el0</code> ì½ê¸°</td>
<td>íƒ€ì´ë¨¸ ì£¼íŒŒìˆ˜ (ex. 62.5MHz)</td>
</tr>
<tr>
<td><code>cntp_tval_el0 = cntfrq</code></td>
<td>1ì´ˆ í›„ ì¸í„°ëŸ½íŠ¸ ë°œìƒ ì˜ˆì•½</td>
</tr>
<tr>
<td><code>cntp_ctl_el0 = 1</code></td>
<td>íƒ€ì´ë¨¸ ì‹œì‘ (IRQ ë°œìƒ ê°€ëŠ¥)</td>
</tr>
</tbody>
</table>
<p>ğŸ’¤ 5. ë©”ì¸ ë£¨í”„ ì§„ì…<br />
- <code>main()</code>ì€ <code>while(1)</code> ë£¨í”„ì— ì§„ì…í•˜ì—¬ ì•„ë¬´ ì¼ë„ í•˜ì§€ ì•ŠìŒ<br />
- ì´í›„ì˜ ë™ì‘ì€ <strong>ì¸í„°ëŸ½íŠ¸ì— ì˜í•´ì„œë§Œ</strong> ë°œìƒí•¨</p>
<p>âš¡ 6. 1ì´ˆ í›„ íƒ€ì´ë¨¸ ì¸í„°ëŸ½íŠ¸ ë°œìƒ<br />
- íƒ€ì´ë¨¸ ë‚´ë¶€ì ìœ¼ë¡œ <code>cntp_tval_el0</code>ì—ì„œ ì¹´ìš´íŠ¸ ê°ì†Œ<br />
- 0ì— ë„ë‹¬í•˜ë©´ <strong>IRQ 30ë²ˆ ë°œìƒ</strong><br />
- CPUëŠ” ë²¡í„° í…Œì´ë¸”ì„ ë”°ë¼ <strong><code>irq_handler</code> ì‹¤í–‰</strong></p>
<p>ğŸ§­ 7. ë²¡í„° í…Œì´ë¸” ì§„ì… (start.S)<br />
<div class="highlight"><pre><span></span><code><span class="nl">vector_table:</span>
<span class="w">    </span><span class="nf">b</span><span class="w"> </span><span class="no">sync_handler</span><span class="w">       </span><span class="c1">// Synchronous Exception</span>
<span class="w">    </span><span class="nf">b</span><span class="w"> </span><span class="no">irq_handler</span><span class="w">        </span><span class="c1">// IRQ ë°œìƒ ì‹œ ì—¬ê¸°ê°€ ì‹¤í–‰ë¨</span>
<span class="w">    </span><span class="nf">b</span><span class="w"> </span><span class="no">fiq_handler</span><span class="w">        </span><span class="c1">// FIQ</span>
<span class="w">    </span><span class="nf">b</span><span class="w"> </span><span class="no">error_handler</span><span class="w">      </span><span class="c1">// SError</span>

<span class="nl">irq_handler:</span>
<span class="w">    </span><span class="nf">bl</span><span class="w"> </span><span class="no">irq_handler_c</span><span class="w">     </span><span class="c1">// ì‹¤ì œ C í•¸ë“¤ëŸ¬ í˜¸ì¶œ</span>
<span class="w">    </span><span class="nf">eret</span><span class="w">                 </span><span class="c1">// ë³µê·€</span>
</code></pre></div></p>
<p>ğŸ“¦ 8. <code>irq_handler_c()</code> ì‹¤í–‰ (main.c)<br />
<div class="highlight"><pre><span></span><code><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">intid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gic_acknowledge</span><span class="p">();</span><span class="w">  </span><span class="c1">// IRQ ID ì½ê¸°</span>

<span class="n">uart_puts</span><span class="p">(</span><span class="s">&quot;IRQ ID: &quot;</span><span class="p">);</span>
<span class="n">print_dec</span><span class="p">(</span><span class="n">intid</span><span class="p">);</span><span class="w">                        </span><span class="c1">// &quot;IRQ ID: 30&quot; ì¶œë ¥</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">intid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">uart_puts</span><span class="p">(</span><span class="s">&quot;Tick!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w">               </span><span class="c1">// &quot;Tick!&quot; ì¶œë ¥</span>
<span class="w">    </span><span class="n">timer_init</span><span class="p">();</span><span class="w">                        </span><span class="c1">// ë‹¤ì‹œ íƒ€ì´ë¨¸ ì¬ì„¤ì • (1ì´ˆ í›„ ë°˜ë³µ)</span>
<span class="p">}</span>

<span class="n">gic_eoi</span><span class="p">(</span><span class="n">intid</span><span class="p">);</span><span class="w">                          </span><span class="c1">// GICì— ì²˜ë¦¬ ì™„ë£Œ ì•Œë¦¼</span>
</code></pre></div></p>
<p>ğŸ” 9. ë£¨í”„ ë°˜ë³µ<br />
- ë‹¤ì‹œ íƒ€ì´ë¨¸ ì„¤ì •ë¨ (<code>timer_init()</code> í˜¸ì¶œ)<br />
- ë˜ 1ì´ˆ ë’¤ IRQ 30 ë°œìƒ â†’ ìœ„ ê³¼ì • ë°˜ë³µ</p>
<p>.section .text<br />
.global _start</p>
<p>_start:<br />
    // ë²¡í„° í…Œì´ë¸” ë“±ë¡<br />
    ldr x0, =vector_table<br />
    msr VBAR_EL1, x0<br />
    isb</p>
<div class="highlight"><pre><span></span><code>// GIC ì´ˆê¸°í™”
bl gic_init

// CNTV Timer ì„¤ì • (1ì´ˆ)
ldr x1, =0x3B9ACA00      // 1,000,000,000 ticks
msr cntv_tval_el0, x1
mov x2, #1
msr cntv_ctl_el0, x2

// IRQ ì–¸ë§ˆìŠ¤í¬
msr DAIFClr, #2
</code></pre></div>
<p>1:  wfe<br />
    b 1b</p>
<p>.align 11<br />
vector_table:<br />
    // Synchronous EL1t<br />
    b default_handler<br />
    .space 0x80 - 4</p>
<div class="highlight"><pre><span></span><code>// IRQ EL1t
b default_handler
.space 0x80 - 4

// FIQ EL1t
b default_handler
.space 0x80 - 4

// SError EL1t
b default_handler
.space 0x80 - 4

// Synchronous EL1h
b default_handler
.space 0x80 - 4

// IRQ EL1h
b irq_handler
.space 0x80 - 4

// FIQ EL1h
b default_handler
.space 0x80 - 4

// SError EL1h
b default_handler
.space 0x80 - 4
</code></pre></div>
<p>default_handler:<br />
    b .</p>
<p>irq_handler:<br />
    // ë©”ì‹œì§€ ì¶œë ¥<br />
    ldr x0, =tick_msg<br />
print_loop:<br />
    ldrb w1, [x0], #1<br />
    cbz w1, tick_done<br />
    bl putc<br />
    b print_loop</p>
<p>tick_done:<br />
    // íƒ€ì´ë¨¸ ì¬ì„¤ì •<br />
    ldr x1, =0x3B9ACA00<br />
    msr cntv_tval_el0, x1</p>
<div class="highlight"><pre><span></span><code>// ì¸í„°ëŸ½íŠ¸ EOI ì²˜ë¦¬
ldr x0, =0x08010010
mov w1, #27            // Timer IRQ ID 27
str w1, [x0]

eret
</code></pre></div>
<p>putc:<br />
    ldr x2, =0x09000000    // UART MMIO<br />
wait_uart:<br />
    ldr w3, [x2, #0x18]<br />
    tst w3, #0x20<br />
    b.ne wait_uart<br />
    str w1, [x2]<br />
    ret</p>
<p>gic_init:<br />
    ldr x0, =0x08000000    // GIC Distributor<br />
    mov w1, #1<br />
    str w1, [x0]           // GICD_CTLR</p>
<div class="highlight"><pre><span></span><code>add x1, x0, #0x100     // GICD_ISENABLER0
mov w2, #(1 &lt;&lt; 27)     // Timer IRQ ID 27
str w2, [x1]

ldr x0, =0x08010000    // GICC base
mov w1, #1
str w1, [x0]           // GICC_CTLR

add x1, x0, #0x4       // GICC_PMR
mov w2, #0xFF
str w2, [x1]

ret
</code></pre></div>
<p>tick_msg:<br />
    .asciz "Tick!\n"</p>
<p>ê²°ê³¼<br />
Tick!<br />
Tick!<br />
Tick!</p>
<h3 id="mmu">&gt; mmu(ë©”ëª¨ë¦¬ ë§¤ë‹ˆì§€ë¨¼íŠ¸ ìœ ë‹›)<a class="headerlink" href="#mmu" title="Permanent link">&para;</a></h3>
<p>ë¬¼ë¦¬ ì£¼ì†Œì™€ ê°€ìƒ ì£¼ì†Œë¥¼ ë§¤í•‘í•´ì¤€ë‹¤. ë”°ë¼ì„œ ìœ ì €ëª¨ë“œ/ì»¤ë„ëª¨ë“œë¥¼ ë¶„ë¦¬í•˜ì—¬ í”„ë¡œì„¸ìŠ¤ë¥¼ ê²©ë¦¬í•˜ê³  ë©”ëª¨ë¦¬ë¥¼ ë³´í˜¸í•œë‹¤.<br />
step 1. í˜ì´ì§€ í…Œì´ë¸” ì¤€ë¹„<br />
arm64ì—ì„œëŠ” ê¸°ë³¸ìœ¼ë¡œ L1 -&gt; L2 -&gt; L3 í…Œì´ë¸”ë¡œ ê³„ì¸µí™”ë¥¼ í•˜ì§€ë§Œ ì—¬ê¸°ì„  identity mappingìœ¼ë¡œ êµ¬ì„±<br />
step 2. mmu ë ˆì§€ìŠ¤í„°<br />
TTBRO_EL1 : í˜ì´ì§€ í…Œì´ë¸” ë² ì´ìŠ¤ ì£¼ì†Œ<br />
TCR_EL1 : ì£¼ì†Œ í¬ê¸° ì„¤ì •<br />
MAIR_EL1 : ë©”ëª¨ë¦¬ ì†ì„±<br />
SCTLR_EL1 : mmu í™œì„±í™”</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>